# FamilyApp — Agents Documentation

## Общее
FamilyApp построен модульно. Каждый агент — это самостоятельный сервис/подсистема, решающая отдельную задачу приложения.  
Агенты связаны с ядром через **Providers**, работают с локальным кешем (Hive), облачным хранилищем (Firebase) и шифрованием (EncryptionService).

---

## Список агентов

### 1. **DataAgent**
- **Назначение**: управление всеми базовыми данными (члены семьи, события, задачи).
- **Входы**: UI-запросы от провайдеров `FamilyData`, `ScheduleData`.
- **Выходы**: обновлённое состояние; синхронизация с Hive (офлайн) и Firestore (онлайн).
- **Особенности**:
  - Поддержка офлайн-режима.
  - Реплей операций при восстановлении сети.
  - Использует `EncryptionService` для шифрования.

---

### 2. **ChatAgent**
- **Назначение**: обработка чатов и сообщений.
- **Входы**: новые сообщения из UI.
- **Выходы**: зашифрованные сообщения в Firestore; realtime-синхронизация на все устройства семьи.
- **Особенности**:
  - AES-256-GCM шифрование перед отправкой.
  - Хранение ключей в `flutter_secure_storage`.
  - Поддержка статусов сообщений (отправлено/доставлено/прочитано).

---

### 3. **LocationAgent**
- **Назначение**: геолокация и умные напоминания.
- **Входы**: GPS-события от устройства.
- **Выходы**: локальные уведомления при приближении к заданным точкам (магазин, АЗС и т.д.).
- **Особенности**:
  - Работа в фоне (Android/iOS).
  - Интеграция с `geolocator` и системными уведомлениями.

---

### 4. **ScheduleAgent**
- **Назначение**: управление расписанием и календарём.
- **Входы**: новые события/занятия из UI.
- **Выходы**: Firestore-синхронизация, локальные напоминания.
- **Особенности**:
  - Фильтрация и поиск.
  - Интеграция с календарями устройств (будущее расширение).

---

### 5. **GalleryAgent**
- **Назначение**: управление семейными фото/видео.
- **Входы**: медиафайлы от пользователей.
- **Выходы**: сохранение в Firebase Storage + шифрование метаданных.
- **Особенности**:
  - Управление доступом (приватные альбомы).
  - Быстрый просмотр/кеширование изображений.

---

### 6. **FriendsAgent**
- **Назначение**: социальные связи между семьями.
- **Входы**: запросы на добавление/доступ.
- **Выходы**: список друзей-семей; настройка видимости событий/галереи.
- **Особенности**:
  - Управление правами доступа.
  - Подготовка к социальным сценариям (совместные чаты, мероприятия).

---

### 7. **AIAgent**
- **Назначение**: интеллектуальные подсказки и рекомендации.
- **Входы**: профили пользователей, календарь, задачи.
- **Выходы**: идеи подарков, поздравления, предложения досуга.
- **Особенности**:
  - Работает локально + через облачные AI API.
  - Настраиваемый уровень персонализации.

---

## Будущие агенты
- **NotificationAgent**: централизованная работа с пуш-уведомлениями.
- **PaymentAgent**: подписки и оплата.
- **BackupAgent**: резервное копирование в облако и восстановление.

---

## Принципы взаимодействия агентов
1. **Через Providers** — каждый агент даёт публичный API для UI.  
2. **Через Firestore** — для синхронизации в реальном времени.  
3. **Через EncryptionService** — все чувствительные данные шифруются.  
4. **Через Hive** — локальный кеш и офлайн-очередь операций.  

---
